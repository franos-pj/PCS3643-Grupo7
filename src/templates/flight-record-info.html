{% load myfilters %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.js"
        integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous" />
    <!-- Bootstrap icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>
    <title>Information for a specific flight</title>
</head>

<body>
    <div class="container mt-4">
        <div class="row">
            <h2>Tela com as informações de voo</h2>
            <p>Permitirá vizualizar as informações</p>
            <div id="infoFlightList">
                <div class="mt-4">
                    <div class="col-md-6">
                        <div class="h-100 p-5 bg-light rounded-3">
                            <h2>Voo {{flight.route}}</h2>
                            <hr />
                            <p><b>Data prevista:</b> {{flight.scheduledDate}}</p>
                            <p><b>Data:</b> {{flight.realDate}}</p>
                            <p><b>Hora:</b> {{flight.realTime}}</p>
                            <p><b>Status:</b> {{flight.status}}</p>
                        </div>
                    </div>
                </div>
                <div class="col-auto mt-4">
                    <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal"
                        data-bs-target="#deleteModal">
                        <i class="bi bi-trash-fill"></i>
                        Excluir
                    </button>
                </div>
            </div>
            <div class="row">
                <a href="{% url 'flightsRecords' %}" class="btn btn-danger col-auto mt-5">
                    Voltar a Registros de Voos
                </a>
            </div>
        </div>
    </div>

    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="deleteModalLabel">
                        Confirme exclusão
                    </h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Você deseja mesmo excluir esse voo?</p>
                    <small class="text-muted">
                        Esse voo será excluído permanentemente.
                    </small>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" aria-label="Close">
                        Não
                    </button>
                    <button type="button" class="btn btn-danger" data-bs-toggle="modal"
                        data-bs-target="#deleteConfirmedModal" id="deleteSubmit">
                        <i class="bi bi-trash-fill"></i>
                        Excluir</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="deleteConfirmedModal" tabindex="-1" aria-labelledby="deleteConfirmedModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body  text-center">
                    <h4 class="modal-title" id="deleteConfirmedModalLabel">
                    </h4>
                    <a href="{% url 'flightsRecords' %}" class=" btn btn-primary mt-4">
                        OK
                    </a>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#deleteSubmit').click(function (event) {
                console.log("deletar")
                $.ajax({
                    type: 'DELETE',
                    url: '{% url "flightRecordInfo" route scheduledDate %}',
                    dataType: 'json',
                    data:
                    {
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    success: function (response) {
                        console.log(response)
                        if (response.success) {
                            $('#deleteConfirmedModalLabel').text("Voo " + response.route + " (" + response.scheduledDate + ") excluído com sucesso ")
                            $('#deleteConfirmedModalLabel').addClass("text-success")
                            $('#deleteConfirmedModalLabel').append('<i class="bi bi-check2-circle" id="checkIcon"></i>')
                        }
                        else {
                            $('#checkIcon').hide()
                            $('#deleteConfirmedModalLabel').text("Não foi possível excluir o voo " + response.route + " (" + response.scheduledDate + ") ")
                            $('#deleteConfirmedModalLabel').addClass("text-danger")
                            $('#deleteConfirmedModalLabel').append('<i class="bi bi-emoji-frown" id = "failureIcon"></i>')
                        }
                    }
                })
            })
        })
    </script>
</body>

</html>